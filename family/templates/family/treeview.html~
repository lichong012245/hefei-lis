{% load staticfiles %}
<!DOCTYPE html>
<head>
<link rel="stylesheet" href="{% static "dist/themes/default/style.css" %}"/>
<!--script src="{% static "dist/libs/jquery.js" %}"></script-->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="{% static "dist/jstree.min.js" %}"></script>

<script>
$(function () { $('#jstree_div').on("select_node.jstree", function (e, data) {
           var loc = data.instance.get_node(data.node, true).children('a').attr('href');
        $.ajax({
        url: loc, 
        success: function(data) {
            $("#name").html(data.pk);
            $("#sex").html(data.sex);
        },
        crossDomain: false
    }).fail(function() {
    alert(loc);
  });            
    }).jstree({
"plugins" : [ "themes", "ui","search" ]
}); 
var to = false;
  $('#jstree_div_q').keyup(function () {
    if(to) { clearTimeout(to); }
    to = setTimeout(function () {
      var v = $('#jstree_div_q').val();
      $('#jstree_div').jstree(true).search(v);
    }, 250);
  });
});
</script>
<script>
function send_request(){
  $.get("/family/test/", function(data){
    $("#name").html(data.name);
    $("#sex").html(data.sex);
  });
}
</script>
</head>
<body>


<input type="text" id="jstree_div_q" value="" style="margin:0em auto 1em auto; display:block; padding:4px; border-radius:4px; border:1px solid silver;"/>
   


<div id="jstree_div">


{% for item, info in tree %}
    {% if info.open %}
        <ul><li data-jstree='{"icon":"{% static "dist/themes/default/Person.png" %}"}'>
    {% else %}
        </li><li data-jstree='{"icon":"{% static "dist/themes/default/Person.png" %}"}'>
    {% endif %}

    <a href="{% url 'member-detail' item.pk %}">{{ item }}</a>

    {% for close in info.close %}
        </li></ul>
    {% endfor %}
{% endfor %}
</div>

<div>
<label>Name: </label><p id="name"></p>
<label>Sex: </label><p id="sex"></p>
<label>Desc: </label><p id="desc"></p>
<label>branch: </label><p id="branch">1</p>
<input type="button" onclick="send_request();" value="Request this page with AJAX" /><br/>
</div>
</body>
</html>
